


# 第八章 守护进程(Daemon)
## 8.1 前言
Linux常用于服务器，程序通常不运行在前台。运行于前台的进程和终端关联，一旦终端关闭，进程也随之退出。因为守护进程不和终端关联，因此它的标准输出和标准输入也无法工作，调试信息应该写入到普通文件中，以便将来进行错误定位和调试。而且守护进程通常以root权限运行。

## 8.2 编程规则
- 调用fork，并让父进程退出
- 设置umask为0
- 调用setuid创建新会话
- 重新设置当前目录/根目录
- 关闭不需要的文件描述符
- 重定向标准输入/标准输出/标准错误到/dev/null
- 和终端脱离关系

## 8.3 出错处理
由于不能再使用标准输入和输出，因此需要调用以下函数来输出调试信息。

![Snip20161009_33](/assets/Snip20161009_33.png)

## 8.4 单例
守护程序往往只有一个实例，而不允许多个，可以用文件锁来实现单例。

## 8.5 惯例
惯例是指大家都这么做，不这么做显得不专业的事情。
- 单例文件路径在/var/run目录下，内容为该进程ID
- 配置文件应该在/etc目录下
- 守护的启动脚本通常放在/etc/init.d目录下
